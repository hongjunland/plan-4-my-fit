#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# 민감한 정보 검사
echo "🔍 민감한 정보 검사 중..."

# 실제 API 키 패턴 검사 (예시 제외)
if git diff --cached --name-only | xargs grep -l "sk-[a-zA-Z0-9]\{20,\}" 2>/dev/null | grep -v "SECURITY.md"; then
  echo "❌ 실제 OpenAI API 키가 감지되었습니다!"
  echo "실제 API 키를 커밋하지 마세요. 플레이스홀더를 사용하세요."
  exit 1
fi

# 실제 Supabase URL 패턴 검사 (테스트 파일 제외)
if git diff --cached --name-only | xargs grep -l "https://[a-z0-9]\{20\}\.supabase\.co" 2>/dev/null | grep -v "__tests__"; then
  echo "❌ 실제 Supabase URL이 감지되었습니다!"
  echo "실제 URL을 커밋하지 마세요. YOUR-PROJECT-ID.supabase.co를 사용하세요."
  exit 1
fi

# 실제 JWT 토큰 패턴 검사 (길이 50자 이상)
if git diff --cached --name-only | xargs grep -l "eyJ[a-zA-Z0-9]\{50,\}" 2>/dev/null; then
  echo "❌ 실제 JWT 토큰이 감지되었습니다!"
  echo "실제 토큰을 커밋하지 마세요. YOUR-SUPABASE-ANON-KEY를 사용하세요."
  exit 1
fi

echo "✅ 보안 검사 통과"

# 린트 및 타입 체크 (에러 무시하고 계속 진행)
echo "🔍 코드 품질 검사 중..."
pnpm lint --max-warnings 10 || echo "⚠️ 린트 경고가 있지만 계속 진행합니다."